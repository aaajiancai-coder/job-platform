<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.job.mapper.JobMapper">
    <!-- ...原有SQL... -->
    <select id="selectJobsWithCompanyName" resultType="com.job.dto.JobWithCompanyDTO">
        SELECT
            j.id,
            j.title,
            j.location,
            j.salary_range AS salaryRange,
            j.job_type AS jobType,
            c.company_name AS companyName
        FROM jobs j
        LEFT JOIN company_profiles c ON j.company_id = c.id
        <where>
            <if test="job.title != null and job.title != ''">
                AND j.title LIKE CONCAT('%', #{job.title}, '%')
            </if>
            <if test="job.location != null and job.location != ''">
                AND j.location = #{job.location}
            </if>
            <if test="job.jobType != null and job.jobType != ''">
                AND j.job_type = #{job.jobType}
            </if>
            AND j.status = 1
        </where>
        ORDER BY j.created_at DESC
        LIMIT #{offset}, #{pageSize}
    </select>
    <!-- ...省略... -->
    <select id="selectJobWithCompanyById" resultType="com.job.dto.JobWithCompanyDTO">
        SELECT
            j.id,
            j.title,
            c.company_name AS companyName,
            j.salary_range AS salaryRange,
            j.location,
            j.job_type AS jobType,
            j.education_requirement AS educationRequirement,
            j.experience_requirement AS experienceRequirement,
            j.description,
            j.requirements
        FROM jobs j
        LEFT JOIN company_profiles c ON j.company_id = c.id
        WHERE j.id = #{id}
    </select>
    <select id="selectJobsWithCompanyKeyword" resultType="com.job.dto.JobWithCompanyDTO">
        SELECT
            j.id,
            j.title,
            j.location,
            j.salary_range AS salaryRange,
            j.job_type AS jobType,
        c.company_name AS companyName
        FROM jobs j
        LEFT JOIN company_profiles c ON j.company_id = c.id
        <where>
            <if test="keyword != null and keyword != ''">
                AND (j.title LIKE CONCAT('%', #{keyword}, '%') OR c.company_name LIKE CONCAT('%', #{keyword}, '%'))
            </if>
            <if test="location != null and location != ''">
                AND j.location = #{location}
            </if>
            <if test="type != null and type != ''">
                AND j.job_type = #{type}
            </if>
            AND j.status = 1
        </where>
        ORDER BY j.created_at DESC
        LIMIT #{offset}, #{pageSize}
    </select>

    <select id="countJobsWithCompanyKeyword" resultType="int">
        SELECT COUNT(*)
        FROM jobs j
        LEFT JOIN company_profiles c ON j.company_id = c.id
        <where>
            <if test="keyword != null and keyword != ''">
                AND (j.title LIKE CONCAT('%', #{keyword}, '%') OR c.company_name LIKE CONCAT('%', #{keyword}, '%'))
            </if>
            <if test="location != null and location != ''">
                AND j.location = #{location}
            </if>
            <if test="type != null and type != ''">
                AND j.job_type = #{type}
            </if>
            AND j.status = 1
        </where>
    </select>
    <select id="selectByCompanyIdPaged" resultType="com.job.entity.Job">
        SELECT *
        FROM jobs
        WHERE company_id = #{companyId}
        ORDER BY created_at DESC
        LIMIT #{offset}, #{pageSize}
    </select>
    <select id="countJobsWithCompanyName" resultType="java.lang.Integer" parameterType="com.job.entity.Job">
        SELECT COUNT(*)
        FROM jobs
        WHERE company_id = #{companyId}
    </select>
</mapper>
